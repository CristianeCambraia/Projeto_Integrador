{% extends 'base.html' %}

{% block content %}
<div class="lista-container">
    <h2 class="titulo">Produtos Cadastrados</h2>
    
    <div class="filtro-orcamentos" style="margin-left: 15px;">
        <form method="get" style="display: flex; gap: 10px; align-items: center;">
            <input type="text" name="filtro" placeholder="Filtrar por Nome, ID, Fornecedor ou Código de Barras" value="{{ filtro|default:'' }}">
            <select name="periodo" style="padding: 8px; font-size: 12px; border: 1px solid #ddd; border-radius: 3px;">
                <option value="">Todos</option>
                <option value="1" {% if request.GET.periodo == '1' %}selected{% endif %}>Último dia</option>
                <option value="7" {% if request.GET.periodo == '7' %}selected{% endif %}>Últimos 7 dias</option>
                <option value="30" {% if request.GET.periodo == '30' %}selected{% endif %}>Últimos 30 dias</option>
            </select>
            <button type="submit" class="btn-filtrar">Filtrar</button>
            <a href="{% url 'lista_produtos' %}" class="btn-limpar">Limpar</a>
        </form>
    </div>
    
    <ul class="lista">
        {% for p in produtos %}
            <li class="produto-item">
                <div class="produto-info" style="margin-left: 5px;">
                    <strong>ID:</strong> {{ p.id }} - <strong>Fornecedor:</strong> {{ p.fornecedor|default:"Não informado" }} - {{ p.nome }} - R$ {{ p.preco }} - {{ p.quantidade }} {{ p.unidade }}
                </div>
                <div style="margin-left: 5px; margin-top: 5px;">
                    <strong>Validade:</strong> {{ p.validade|date:"d/m/Y"|default:"Não informada" }}
                </div>
                {% if p.descricao %}
                    <div class="produto-descricao">
                        <span class="descricao-preview">{{ p.descricao|truncatechars:50 }}</span>
                        <span class="descricao-completa" style="display: none;">{{ p.descricao }}</span>
                        {% if p.descricao|length > 50 %}
                            <button class="btn-expandir" onclick="toggleDescricao(this)">Ver mais</button>
                        {% endif %}
                    </div>
                {% endif %}
                <div class="produto-acoes">
                    <a href="{% url 'editar_produto' p.id %}" class="btn-editar">Editar</a>
                </div>
            </li>
        {% empty %}
            <li style="text-align: left; margin-left: 10px;">Nenhum produto cadastrado.</li>
        {% endfor %}
    </ul>

    <script>
    function toggleDescricao(btn) {
        const preview = btn.parentElement.querySelector('.descricao-preview');
        const completa = btn.parentElement.querySelector('.descricao-completa');
        
        if (preview.style.display === 'none') {
            preview.style.display = 'inline';
            completa.style.display = 'none';
            btn.textContent = 'Ver mais';
        } else {
            preview.style.display = 'none';
            completa.style.display = 'inline';
            btn.textContent = 'Ver menos';
        }
    }
    </script>

    <!-- Corrigido para a URL correta da view de cadastro -->
    <div style="margin-left: 5px;">
        <a href="{% url 'cadastrar_produto' %}" class="btn-salvar">Novo Produto</a>
    </div>
</div>
{% endblock %}
