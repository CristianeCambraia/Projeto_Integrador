{% extends 'base.html' %}

{% block content %}
<div class="container-lista-orcamentos">
  <h2>Serviços Cadastrados</h2>
  
  <div class="filtro-orcamentos">
    <div style="display: flex; gap: 10px; align-items: center;">
      <input type="text" id="filtroServico" placeholder="Filtrar por ID ou Nome" style="padding: 8px; border: 1px solid #ddd; border-radius: 3px;">
      <button onclick="limparFiltro()" class="btn-limpar" style="background: #6c757d;">Limpar</button>
    </div>
  </div>

  <ul class="lista-orcamentos">
    {% for servico in servicos %}
      <li class="item-orcamento servico-item" data-id="{{ servico.id }}" data-nome="{{ servico.nome|lower }}">
        <div class="row-two-col">
          <div class="col-left">
            <div class="field"><strong>ID:</strong> {{ servico.id }}</div>
            <div class="field"><strong>Nome:</strong> {{ servico.nome }}</div>
            <div class="field"><strong>Unidade:</strong> {{ servico.unidade }}</div>
          </div>
          <div class="col-right">
            <div class="field"><strong>Preço:</strong> R$ {{ servico.preco }}</div>
            <div class="field"><strong>Quantidade:</strong> {{ servico.quantidade }}</div>
            <div class="field"><strong>Data:</strong> {{ servico.data_hora|date:"d/m/Y" }}</div>
          </div>
        </div>
        {% if servico.descricao %}
        <div class="field" style="margin-top: 10px;">
          <strong>Descrição:</strong> {{ servico.descricao }}
        </div>
        {% endif %}
        {% if servico.observacao %}
        <div class="field" style="margin-top: 10px;">
          <strong>Observação:</strong> {{ servico.observacao }}
        </div>
        {% endif %}
      </li>
    {% empty %}
      <li id="nenhumServico">Nenhum serviço cadastrado.</li>
    {% endfor %}
  </ul>

  <div class="botoes-orcamento">
    <a href="{% url 'cadastrar_servico' %}" class="btn-padrao">Novo Serviço ➕</a>
    <a href="{% url 'fornecedores' %}" class="btn-padrao voltar">Voltar ⤴</a>
  </div>
</div>

<script>
function filtrarServicos() {
  const filtro = document.getElementById('filtroServico').value.toLowerCase();
  const items = document.querySelectorAll('.servico-item');
  let visivel = 0;
  
  items.forEach(item => {
    const id = item.getAttribute('data-id');
    const nome = item.getAttribute('data-nome');
    
    if (id.includes(filtro) || nome.includes(filtro)) {
      item.style.display = 'block';
      visivel++;
    } else {
      item.style.display = 'none';
    }
  });
  
  const nenhumItem = document.getElementById('nenhumServico');
  if (nenhumItem) {
    nenhumItem.style.display = visivel === 0 && filtro !== '' ? 'block' : 'none';
  }
}

function limparFiltro() {
  document.getElementById('filtroServico').value = '';
  filtrarServicos();
}

document.getElementById('filtroServico').addEventListener('input', filtrarServicos);
</script>

<style>
.container-lista-orcamentos {
    border-radius: 30px 30px 30px 30px !important;
}
</style>
{% endblock %}