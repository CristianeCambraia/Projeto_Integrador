{% extends 'base.html' %}

{% block content %}
<div class="emitir-orcamento-container">
  <h2 class="titulo">OrÃ§amento #{{ orcamento.id }}</h2>

  <form class="container-text"  method="post" action="#">
    {% csrf_token %}

    <div class="cliente-dados">
      <label><strong>Cliente:</strong></label>
      <input type="text" name="cliente" value="{{ orcamento.cliente }}" disabled>
                    
      <label><strong>Data:</strong></label>
      <input type="date" name="data" value="{{ orcamento.data|date:'Y-m-d' }}" disabled>
                    
      <label><strong>CNPJ:</strong></label>
      <input type="text" name="cnpj" value="{{ orcamento.cnpj }}" disabled>
                    
      <label><strong>EndereÃ§o:</strong></label>
      <input type="text" name="endereco" value="{{ orcamento.endereco }}" disabled>
                    
      <label><strong>Cidade:</strong></label>
      <input type="text" name="cidade" value="{{ orcamento.cidade }}" disabled>
                    
      <label><strong>Telefone:</strong></label>
      <input type="tel" name="telefone" value="{{ orcamento.telefone }}" disabled>
                    
      <label><strong>E-mail:</strong></label>
      <input type="email" name="email" value="{{ orcamento.email }}" disabled>

    </div>

    <table class="itens-orcamento">
      <thead>
        <tr>
          <th>DescriÃ§Ã£o</th>
          <th>Quantidade</th>
          <th>Valor</th>
        </tr>
      </thead>
      <tbody>
        {% for linha in linhas %}
        <tr>
          <td><input type="text" name="descricao_{{ forloop.counter }}" value="{{ linha.descricao }}" disabled></td>
          <td><input type="number" name="quantidade_{{ forloop.counter }}" min="1" value="{{ linha.quantidade }}" disabled></td>
          <td><input type="text" name="valor_{{ forloop.counter }}" value="{{ linha.valor }}" disabled></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <div style="margin: 20px 0; text-align: right;">
        <label><strong>Valor Total: R$ </strong></label>
        <input type="text" id="valorTotal" name="valor_total" readonly style="background-color: #f0f0f0; font-weight: bold; width: 150px;">
    </div>

    <div class="observacao-container">
        <label><strong>ObservaÃ§Ã£o:</strong></label>
        <textarea name="observacao" rows="4" disabled>{{ orcamento.observacao }}</textarea>
    </div>

    <div class="botoes">
      <button type="button" onclick="window.print()" class="btn-salvar">Imprimir ðŸ’¾</button>
      <a href="{% url 'exportar_pdf_orcamento' orcamento.id %}" class="btn-salvar">Exportar PDF ðŸ“„</a>
      <a href="{% url 'orcamentos_emitidos' %}" class="btn-voltar">Voltar â¤´</a>
    </div>
  </form>
</div>

<script>
// Calcular valor total ao carregar a pÃ¡gina
document.addEventListener('DOMContentLoaded', function() {
    let total = 0;
    const tbody = document.querySelector('.itens-orcamento tbody');
    const linhas = tbody.querySelectorAll('tr');
    
    linhas.forEach(linha => {
        const quantidade = parseFloat(linha.querySelector('input[name*="quantidade"]').value) || 0;
        const valor = parseFloat(linha.querySelector('input[name*="valor"]').value.replace(',', '.')) || 0;
        total += quantidade * valor;
    });
    
    document.getElementById('valorTotal').value = total.toFixed(2).replace('.', ',');
});
</script>
{% endblock %}
