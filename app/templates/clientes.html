{% extends 'base.html' %}

{% block content %}
<div class="form-container">
    <h2 class="titulo">Cadastro de Cliente</h2>

    <form method="post" action="{% url 'salvar_cliente' %}">
        {% csrf_token %}
        <div class="form-grid">
            <p>
                <label for="id_nome">Nome:</label>
                <input type="text" name="nome" id="id_nome" placeholder="Nome" required>
            </p>
            <p>
                <label for="id_data_nascimento">Data de nascimento:</label>
                <input type="date" name="data_nascimento" id="id_data_nascimento" max="2006-12-31" title="Idade deve ser maior ou igual a 18 anos" onchange="validateAge(this)" required>
            </p>
            <p>
                <label for="id_cpf">CPF:</label>
                <input type="text" name="cpf" id="id_cpf" placeholder="XXX.XXX.XXX-XX" maxlength="14" pattern="[0-9]{3}\.[0-9]{3}\.[0-9]{3}-[0-9]{2}" title="Digite apenas números. Formato: XXX.XXX.XXX-XX" oninput="formatCPF(this)" onkeypress="return /[0-9]/.test(event.key) || event.key === 'Backspace'" required>
            </p>
            <p>
                <label for="id_endereco">Endereço:</label>
                <input type="text" name="endereco" id="id_endereco" placeholder="Endereço" required>
            </p>
            <p>
                <label for="id_bairro">Bairro:</label>
                <input type="text" name="bairro" id="id_bairro" placeholder="Bairro" required>
            </p>
            <p>
                <label for="id_complemento">Complemento:</label>
                <input type="text" name="complemento" id="id_complemento" placeholder="Complemento">
            </p>
            <p>
                <label for="id_cidade">Cidade:</label>
                <input type="text" name="cidade" id="id_cidade" placeholder="Cidade" required>
            </p>
            <p>
                <label for="id_uf">UF:</label>
                <input type="text" name="uf" id="id_uf" placeholder="UF" maxlength="2" required>
            </p>
            <p>
                <label for="id_cep">CEP:</label>
                <input type="text" name="cep" id="id_cep" placeholder="XXXXX-XXX" maxlength="9" pattern="[0-9]{5}-[0-9]{3}" title="Digite apenas números. Formato: XXXXX-XXX" oninput="formatCEP(this)" onkeypress="return /[0-9]/.test(event.key) || event.key === 'Backspace'" required>
            </p>
            <p>
                <label for="id_email">Email:</label>
                <input type="email" name="email" id="id_email" placeholder="E-mail" required>
            </p>
            <p>
                <label for="id_telefone">Telefone:</label>
                <input type="text" name="telefone" id="id_telefone" placeholder="(XX) XXXXX-XXXX" maxlength="15" oninput="formatTelefone(this)" onkeypress="return /[0-9]/.test(event.key) || event.key === 'Backspace'" required>
            </p>
        </div>

        <div class="form-buttons">
            <a href="{% url 'lista_cliente' %}" class="btn btn-editar">Clientes Cadastrados</a>
            <button type="submit" class="btn btn-salvar">Salvar</button>
            <a href="{% url 'cadastros' %}" class="btn btn-voltar">Voltar ⤴</a>
        </div>
    </form>
</div>

<script>
function formatCPF(input) {
    let v = input.value.replace(/\D/g, '');
    v = v.substring(0, 11);
    if (v.length > 3) v = v.replace(/(\d{3})(\d)/, '$1.$2');
    if (v.length > 6) v = v.replace(/(\d{3})\.(\d{3})(\d)/, '$1.$2.$3');
    if (v.length > 9) v = v.replace(/(\d{3})\.(\d{3})\.(\d{3})(\d)/, '$1.$2.$3-$4');
    input.value = v;
}

function formatCEP(input) {
    let v = input.value.replace(/\D/g, '');
    v = v.substring(0, 8);
    if (v.length > 5) v = v.replace(/(\d{5})(\d)/, '$1-$2');
    input.value = v;
}

function formatTelefone(input) {
    let v = input.value.replace(/\D/g, '');
    v = v.substring(0, 11);
    if (v.length > 2) v = v.replace(/(\d{2})(\d)/, '($1) $2');
    if (v.length > 7) {
        if (v.length <= 10) {
            v = v.replace(/(\(\d{2}\)\s\d{4})(\d)/, '$1-$2');
        } else {
            v = v.replace(/(\(\d{2}\)\s\d{5})(\d)/, '$1-$2');
        }
    }
    input.value = v;
}

function validateAge(input) {
    let birthDate = new Date(input.value);
    let today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    let monthDiff = today.getMonth() - birthDate.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    
    if (age < 18) {
        alert('Erro: Por favor, insira uma data válida. A idade deve ser maior ou igual a 18 anos.');
        input.value = '';
        input.focus();
    }
}
</script>

<style>
.form-container label {
    text-align: left !important;
}
.form-container {
    border-radius: 30px 30px 30px 30px !important;
    background: #e8e8e8 !important;
}
</style>

{% endblock %}
