{% extends 'base.html' %}

{% block content %}
<div class="form-container">
  <div class="header-form">
    <h2 class="titulo">{{ titulo_pagina }}</h2>
    <a href="{% url 'lista_cliente' %}" class="btn-editar">
      Lista &#128196;
    </a>
  </div>

  <form method="post">
    {% csrf_token %}
    <div class="form-grid">
      {{ form.as_p }}
    </div>

    <div class="form-buttons">
      <a href="{% url 'fornecedores' %}" class="btn btn-cancelar">
        Cancelar &#10060;
      </a>
      <button type="submit" class="btn btn-salvar">
        Salvar &#128190;
      </button>
      <a href="{% url 'lista_cliente' %}" class="btn btn-voltar">
        Voltar &#8634;
      </a>
    </div>
  </form>
</div>

<script>
function validateAge(input) {
    let birthDate = new Date(input.value);
    let today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    let monthDiff = today.getMonth() - birthDate.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    
    if (age < 18) {
        alert('Erro: A idade deve ser maior ou igual a 18 anos.');
        input.value = '';
        input.focus();
        return false;
    }
    return true;
}

document.addEventListener('DOMContentLoaded', function() {
    const dataField = document.getElementById('id_data_nascimento');
    if (dataField) {
        // Definir data máxima (18 anos atrás)
        const today = new Date();
        const maxDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
        dataField.max = maxDate.toISOString().split('T')[0];
        
        // Adicionar validação no evento change
        dataField.addEventListener('change', function() {
            validateAge(this);
        });
    }
});
</script>
{% endblock %}