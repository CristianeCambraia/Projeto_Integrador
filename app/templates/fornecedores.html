{% extends 'base.html' %}

{% block content %}
<div class="container">
  <section class="form-box">
    <h2 class="form-title">Cadastro de Fornecedores</h2>

    <form method="post" action="{% url 'salvar_fornecedor' %}">
      {% csrf_token %}
      <div class="form-grid">

        <div class="form-group">
          <label for="id_nome">Nome</label>
          <input type="text" name="nome" id="id_nome" placeholder="Nome" required>
        </div>

        <div class="form-group">
          <label for="id_data_nascimento">Data de Nascimento</label>
          <input type="date" name="data_nascimento" id="id_data_nascimento" max="2006-12-31" title="Idade deve ser maior ou igual a 18 anos" onchange="validateAge(this)" required>
        </div>

        <div class="form-group">
          <label for="id_cnpj">CNPJ</label>
          <input type="text" name="cnpj" id="id_cnpj" placeholder="XX.XXX.XXX/XXXX-XX" maxlength="18" oninput="formatCNPJ(this)" onkeypress="return /[0-9]/.test(event.key) || event.key === 'Backspace'" required>
        </div>

        <div class="form-group">
          <label for="id_endereco">Endereço</label>
          <input type="text" name="endereco" id="id_endereco" placeholder="Endereço" required>
        </div>

        <div class="form-group">
          <label for="id_bairro">Bairro</label>
          <input type="text" name="bairro" id="id_bairro" placeholder="Bairro" required>
        </div>

        <div class="form-group">
          <label for="id_complemento">Complemento</label>
          <input type="text" name="complemento" id="id_complemento" placeholder="Complemento">
        </div>

        <div class="form-group">
          <label for="id_cidade">Cidade</label>
          <input type="text" name="cidade" id="id_cidade" placeholder="Cidade" required>
        </div>

        <div class="form-group">
          <label for="id_uf">UF</label>
          <input type="text" name="uf" id="id_uf" placeholder="UF" maxlength="2" required>
        </div>

        <div class="form-group">
          <label for="id_cep">CEP</label>
          <input type="text" name="cep" id="id_cep" placeholder="XXXXX-XXX" maxlength="9" oninput="formatCEP(this)" onkeypress="return /[0-9]/.test(event.key) || event.key === 'Backspace'" required>
        </div>

        <div class="form-group">
          <label for="id_email">E-mail</label>
          <input type="email" name="email" id="id_email" placeholder="E-mail" required>
        </div>

        <div class="form-group">
          <label for="id_telefone">Telefone</label>
          <input type="text" name="telefone" id="id_telefone" placeholder="(XX) XXXXX-XXXX" maxlength="15" oninput="formatTelefone(this)" onkeypress="return /[0-9]/.test(event.key) || event.key === 'Backspace'" required>
        </div>

      </div>

      <div class="form-buttons">
        <a href="{% url 'lista_fornecedores' %}" class="btn btn-editar">Fornecedores Cadastrados</a>
        <button type="submit" class="btn btn-salvar">Salvar</button>
        <a href="{% url 'home' %}" class="btn btn-voltar">Voltar ⤴</a>
        <a href="{% url 'cadastrar_produto' %}" class="btn btn-cadastrar-produto">Cadastrar Produto</a>
        <a href="{% url 'cadastrar_servico' %}" class="btn btn-cadastrar-servico">Cadastrar Serviço</a>
        <a href="{% url 'clientes' %}" class="btn btn-cadastrar-cliente">Cadastrar Cliente</a>

      </div>

    </form>
  </section>
</div>

<script>
function formatCNPJ(input) {
    let v = input.value.replace(/\D/g, '');
    v = v.substring(0, 14);
    if (v.length > 2) v = v.replace(/(\d{2})(\d)/, '$1.$2');
    if (v.length > 5) v = v.replace(/(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
    if (v.length > 8) v = v.replace(/(\d{2})\.(\d{3})\.(\d{3})(\d)/, '$1.$2.$3/$4');
    if (v.length > 12) v = v.replace(/(\d{2})\.(\d{3})\.(\d{3})\/(\d{4})(\d)/, '$1.$2.$3/$4-$5');
    input.value = v;
}

function formatCEP(input) {
    let v = input.value.replace(/\D/g, '');
    v = v.substring(0, 8);
    if (v.length > 5) v = v.replace(/(\d{5})(\d)/, '$1-$2');
    input.value = v;
}

function formatTelefone(input) {
    let v = input.value.replace(/\D/g, '');
    v = v.substring(0, 11);
    if (v.length > 2) v = v.replace(/(\d{2})(\d)/, '($1) $2');
    if (v.length > 7) {
        if (v.length <= 10) {
            v = v.replace(/(\(\d{2}\)\s\d{4})(\d)/, '$1-$2');
        } else {
            v = v.replace(/(\(\d{2}\)\s\d{5})(\d)/, '$1-$2');
        }
    }
    input.value = v;
}

function validateAge(input) {
    let birthDate = new Date(input.value);
    let today = new Date();
    let age = today.getFullYear() - birthDate.getFullYear();
    let monthDiff = today.getMonth() - birthDate.getMonth();
    
    if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
    }
    
    if (age < 18) {
        alert('Erro: Por favor, insira uma data válida. A idade deve ser maior ou igual a 18 anos.');
        input.value = '';
        input.focus();
    }
}
</script>

{% endblock %}