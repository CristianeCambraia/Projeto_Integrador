{% extends 'base.html' %}

{% block content %}
<div class="lista-container">
    <h2 class="titulo">Fornecedores Cadastrados</h2>
    <div class="filtro-orcamentos">
        <div style="display: flex; gap: 10px; align-items: center;">
            <input type="text" id="filtroFornecedor" placeholder="Filtrar por Nome ou CNPJ" style="padding: 8px; border: 1px solid #ddd; border-radius: 3px;">
            <button onclick="limparFiltro()" class="btn-limpar" style="background: #6c757d;">Limpar</button>
        </div>
    </div>

    <ul class="lista">
        {% for f in fornecedores %}
            <li class="fornecedor-item" data-nome="{{ f.nome|lower }}" data-cnpj="{{ f.cnpj|default:''|lower }}">
                <div class="fornecedor-info">
                    <span class="fornecedor-nome">{{ f.nome }}</span>
                    <span class="status-fornecedor {% if f.ativo %}ativo{% else %}inativo{% endif %}">
                        {% if f.ativo %}Ativo{% else %}Inativo{% endif %}
                    </span>
                </div>
                <div class="fornecedor-email">{{ f.email }}</div>
                <div class="fornecedor-acoes">
                    <a href="{% url 'editar_fornecedor' f.id %}" class="btn-editar">Editar</a>
                    <a href="{% url 'alternar_status_fornecedor' f.id %}" class="btn-status">
                        {% if f.ativo %}Desativar{% else %}Ativar{% endif %}
                    </a>
                </div>
            </li>
        {% empty %}
            <li id="nenhumFornecedor">Nenhum fornecedor cadastrado.</li>
        {% endfor %}
    </ul>

    <div style="display: flex; gap: 10px; justify-content: center;">
        <a href="{% url 'fornecedores' %}" class="btn-salvar">Novo Fornecedor</a>
        <a href="{% url 'fornecedores' %}" class="btn-voltar">Voltar â¤´</a>
    </div>
</div>

<script>
function filtrarFornecedores() {
    const filtro = document.getElementById('filtroFornecedor').value.toLowerCase();
    const items = document.querySelectorAll('.fornecedor-item[data-nome]');
    let visivel = 0;
    
    items.forEach(item => {
        const nome = item.getAttribute('data-nome');
        const cnpj = item.getAttribute('data-cnpj');
        if (nome.includes(filtro) || cnpj.includes(filtro)) {
            item.style.display = 'block';
            visivel++;
        } else {
            item.style.display = 'none';
        }
    });
    
    const nenhumItem = document.getElementById('nenhumFornecedor');
    if (nenhumItem) {
        nenhumItem.style.display = visivel === 0 && filtro !== '' ? 'block' : 'none';
    }
}

function limparFiltro() {
    document.getElementById('filtroFornecedor').value = '';
    filtrarFornecedores();
}

document.getElementById('filtroFornecedor').addEventListener('input', filtrarFornecedores);
</script>

<style>
.lista-container {
    border-radius: 30px 30px 30px 30px !important;
}
</style>
{% endblock %}
