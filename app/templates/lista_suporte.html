{% extends 'base.html' %}

{% block content %}
<div class="lista-suporte-container">
    <div class="header-section">
        <div class="icon-title">
            <div class="icon-circle">
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none">
                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 2.5l.72.72c.39.39.39 1.02 0 1.41L11.41 13l4.31 4.31c.39.39.39 1.02 0 1.41L15 19.44l-4.31-4.31L6.38 19.44l-.72-.72c-.39-.39-.39-1.02 0-1.41L10.59 13 6.28 8.69c-.39-.39-.39-1.02 0-1.41L7 6.56l4.31 4.31L15.62 6.56z" fill="#2d3748"/>
                </svg>
            </div>
            <div>
                <h1>Chamadas de Suporte</h1>
                <p>Gerencie as solicitações de suporte</p>
            </div>
        </div>
    </div>

    <div class="content-section">
        <!-- Filtro -->
        <div class="filter-section">
            <div class="search-box">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" fill="#666"/>
                </svg>
                <input type="text" id="filtroSuporte" placeholder="Buscar por ID, nome, email ou descrição...">
                <button onclick="limparFiltro()" class="clear-btn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="#666"/>
                    </svg>
                </button>
            </div>
        </div>

    {% if demandas %}
        <div class="tabela-container">
            <table class="tabela-lista">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nome</th>
                        <th>Email</th>
                        <th>Telefone</th>
                        <th>Descrição</th>
                        <th>Data</th>
                    </tr>
                </thead>
                <tbody id="suporteTable">
                    {% for demanda in demandas %}
                    <tr>
                        <td>#{{ demanda.id }}</td>
                        <td>{{ demanda.nome }}</td>
                        <td>{{ demanda.email }}</td>
                        <td>{{ demanda.telefone }}</td>
                        <td class="descricao-cell">{{ demanda.descreva|truncatechars:100 }}</td>
                        <td>{{ demanda.data_criacao|date:"d/m/Y H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="sem-dados">
            <p>Nenhuma chamada de suporte encontrada.</p>
        </div>
    {% endif %}

    <div style="text-align: right;">
        <button type="button" onclick="location.href='{% url 'home' %}'" class="btn-filtrar">Voltar ⤴</button>
    </div>
</div>

<style>
.container-lista-orcamentos {
    border-radius: 30px 30px 30px 30px !important;
}

/* Responsividade para Dev Tools - Header */
@media screen and (max-width: 1400px) {
    header {
        width: 100vw !important;
        padding: 12px 5px !important;
        box-sizing: border-box !important;
        margin: 0 !important;
        position: relative !important;
        left: 0 !important;
        right: 0 !important;
        overflow: hidden !important;
    }
    
    header nav {
        width: 100% !important;
        box-sizing: border-box !important;
    }
    
    header nav ul {
        width: 100% !important;
        box-sizing: border-box !important;
        justify-content: flex-end !important;
        flex-wrap: wrap !important;
    }
    
    .container-lista-orcamentos {
        max-width: 100% !important;
        width: 100% !important;
        margin: 20px 0 0 0 !important;
        padding: 15px !important;
        box-sizing: border-box !important;
    }
}
</style>
{% endblock %}

<!-- Botão Voltar ao Topo -->
<button class="voltar-topo" onclick="voltarAoTopo()">⬆️</button>

<script>
// Função voltar ao topo
function voltarAoTopo() {
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Mostrar/ocultar botão baseado no scroll
window.addEventListener('scroll', function() {
    const botao = document.querySelector('.voltar-topo');
    if (window.scrollY > 300) {
        botao.classList.add('show');
    } else {
        botao.classList.remove('show');
    }
});

// Filtro em tempo real
document.getElementById('filtroSuporte').addEventListener('input', function() {
    const filtro = this.value.toLowerCase();
    const linhas = document.querySelectorAll('#suporteTable tr');
    
    linhas.forEach(function(linha) {
        const textoLinha = linha.textContent.toLowerCase();
        if (textoLinha.includes(filtro)) {
            linha.style.display = '';
        } else {
            linha.style.display = 'none';
        }
    });
});
</script>